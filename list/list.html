<!DOCTYPE html>
<html>
<title>Task List</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="../styles/style.css">

<body>
    <h2>Tasks</h2>
    <p>Bellow are listed the tasks, those marked green are finished.</p>
    <div class="mapContainer"></div>
    
</body>

<script>
    // Simple function which returns tasks from server
    async function fetchTaks() {
        const response = await fetch(`https://simple-crud-node-mongo.herokuapp.com/api/list`)

        let data = await response.json()

        // After obtaining tasks we pass them as parameter
        displayTasks(data)
    }

    // Sort of a render function which displays the fetched data
    function displayTasks(data) {

        const myContent = document.querySelector('.mapContainer')

        // Map method is native to arrays which iterates through them one by one at the same time generating some HTML
        const showInHTML = data.map((task) => {
            let statusImg = 'unchecked.png'
            if (task.checked) {
                statusImg = 'checked.png'
            }
            return `
            <div class="w3-panel w3-card">
                <div class="cardContainer" id="card">
                    <div class="leftPanel">
                        <div class="imgContent">
                            <img class="img" src="../assets/${statusImg}" width="25" alt="checked">
                        </div>
                        <div>
                            <h3 id="title">${task.title}</h3>
                            <p id="desc">${task.description}</p>
                        </div>
                    </div>
                    <div class="arrowContent">
                        <img class="arrow" src="../assets/arrow.png" alt="" onclick="viewTask('${task._id}')">
                    </div>
                </div>
            </div>
            `
        })

        // Appending the array of Card elements to mapContainer
        myContent.innerHTML = showInHTML
    }

    // We simply accept the id from onClick function ln:50, col: 98
    function viewTask(id) {
        // Set the id at local storage because we need it for fetching the data for that task with that id
        localStorage.setItem('ID', id)
        window.location.href = '../single/single.html'
    }

    fetchTaks()
</script>

</html>